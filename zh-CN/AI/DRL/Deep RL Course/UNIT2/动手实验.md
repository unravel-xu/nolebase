# åŠ¨æ‰‹å®éªŒ

ç°åœ¨æˆ‘ä»¬å·²ç»å­¦å®Œäº† Q-Learning ç®—æ³•ï¼Œè®©æˆ‘ä»¬ä»å¤´å¼€å§‹å®ç°å®ƒï¼Œå¹¶åœ¨ä¸¤ä¸ªç¯å¢ƒä¸­è®­ç»ƒ Agentï¼š

1. Frozen-Lake-v1ï¼ˆéæ»‘åŠ¨å’Œæ»‘åŠ¨ç‰ˆæœ¬ï¼‰ï¼šAgent éœ€è¦åœ¨èµ·å§‹çŠ¶æ€ï¼ˆSï¼‰å’Œç›®æ ‡çŠ¶æ€ï¼ˆGï¼‰ä¹‹é—´ç§»åŠ¨ï¼Œä¸”ç§»åŠ¨æ—¶ä»…èƒ½åœ¨å†°å†»çš„ç“·ç –ï¼ˆFï¼‰ä¸Šè¡Œèµ°ä¸èƒ½æ‰å…¥å†°æ´ï¼ˆHï¼‰
2. An autonomous taxiï¼šéœ€è¦å­¦ä¹ åœ¨åŸå¸‚ä¸­å°†ä¹˜å®¢ä» A ç‚¹è¿è¾“åˆ° B ç‚¹

![[pic-20250316105549771.png]]

## å‡†å¤‡å·¥ä½œ
### ğŸ® ç¯å¢ƒ:

- [FrozenLake-v1](https://gymnasium.farama.org/environments/toy_text/frozen_lake/)
- [Taxi-v3](https://gymnasium.farama.org/environments/toy_text/taxi/)

### ğŸ“š RL-Library:

- Python and NumPy
- [Gymnasium](https://gymnasium.farama.org/)

### å®‰è£…ä¾èµ–

- gymnasium: Contains the FrozenLake-v1 â›„ and Taxi-v3 ğŸš• environments
- pygameï¼šUsed for the FrozenLake-v1 and Taxi-v3 UI
- numpyï¼šç”¨äºå¤„ç† Q-table

```bash
!pip install -r https://raw.githubusercontent.com/huggingface/deep-rl-class/main/notebooks/unit2/requirements-unit2.txt
```

```bash
!sudo apt-get update
!sudo apt-get install -y python3-opengl
!apt install ffmpeg xvfb
!pip3 install pyvirtualdisplay
```

virtual screen å¯èƒ½éœ€è¦é‡å¯ notebook runtimeï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰§è¡Œå¦‚ä¸‹ä»£ç å¼ºåˆ¶å´©æºƒï¼Œcolab ä¼šè‡ªåŠ¨é‡å¯ï¼Œæˆ‘ä»¬å†ä»ä¸‹ä¸€ä¸ª cell å¼€å§‹è¿è¡Œ

```python
import os
os.kill(os.getpid(), 9)
```

```python
# Virtual display
from pyvirtualdisplay import Display

virtual_display = Display(visible=0, size=(1400, 900))
virtual_display.start()
```

### å¯¼å…¥åŒ…

```python
import numpy as np
import gymnasium as gym
import random
import imageio	# ç”Ÿæˆå›æ”¾è§†é¢‘
import os
import tqdm

import pickle5 as pickle
from tqdm.notebook import tqdm
```

å‡†å¤‡å·¥ä½œå®Œæˆ

## Part 1ï¼šFrozen Lake â›„ (non slippery version)

### åˆ›å»ºå¹¶äº†è§£ FrozenLake environment â›„

ç¯å¢ƒçš„[è¯´æ˜æ–‡æ¡£](https://gymnasium.farama.org/environments/toy_text/frozen_lake/)

æœ‰ä¸¤ç§å¤§å°çš„ç¯å¢ƒï¼š
- `map_name = "4x4"`ï¼šå¤§å°ä¸º $4\times4$ çš„ç½‘æ ¼
- `map_name = "8x8"`ï¼šå¤§å°ä¸º $8\times8$ çš„ç½‘æ ¼

ç¯å¢ƒæœ‰ä¸¤ç§ä¸åŒçš„æ¨¡å¼ï¼š
- `is_slippery=False`ï¼šåœ¨ frozen lake ä¸Šä¸ä¼šæ»‘åŠ¨ï¼ŒAgent å¯ä»¥æŒ‰é¢„æœŸæ–¹å‘ç§»åŠ¨ï¼ˆç¡®å®šçš„ï¼‰
- `is_slippery=True`ï¼šåœ¨ frozen lake ä¸Šä¼šæ‰“æ»‘ï¼ŒAgent å¯èƒ½ä¸æŒ‰é¢„æœŸæ–¹å‘ç§»åŠ¨ï¼ˆéšæœºçš„ï¼‰

ç°åœ¨æˆ‘ä»¬ç”¨æœ€ç®€å•çš„ç¯å¢ƒï¼šå¤§å°ä¸º $4\times4$ ä¸”ä¸ä¼šæ»‘åŠ¨çš„ frozen lakeï¼Œæ·»åŠ ä¸€ä¸ªåä¸º `render_mode` çš„å‚æ•°æ¥æŒ‡å®šç¯å¢ƒå¯è§†åŒ–æ–¹å¼ã€‚æˆ‘ä»¬å¸Œæœ›æœ€åå½•åˆ¶ç¯å¢ƒçš„è§†é¢‘ï¼Œéœ€è¦è®¾ç½® `render_mode = rgb_array`

[æ–‡æ¡£](https://gymnasium.farama.org/api/env/#gymnasium.Env.render) è§£é‡Šäº†â€œrgb_arrayâ€ï¼šè¿”å›ä¸€ä¸ªè¡¨ç¤ºå½“å‰ç¯å¢ƒçŠ¶æ€çš„å¸§ã€‚ä¸€ä¸ªå¸§æ˜¯ä¸€ä¸ªå½¢çŠ¶ä¸º (x, y, 3) çš„ np.ndarrayï¼Œè¡¨ç¤º $x\times y$ åƒç´ å›¾åƒçš„ RGB å€¼

```python
# Create the FrozenLake-v1 environment using 4x4 map and non-slippery version and render_mode="rgb_array"
env = gym.make("FrozenLake-v1", map_name="4x4", is_slippery=False, render_mode="rgb_array") # TODO use the correct parameters
```

ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç½‘æ ¼ç¯å¢ƒï¼Œç”¨ S è¡¨ç¤º starting stateï¼ŒG è¡¨ç¤º goal stateï¼ŒF è¡¨ç¤º frozen tilesï¼ŒH è¡¨ç¤º holes

```python
# è‡ªå®šä¹‰ç¯å¢ƒ
desc=["SFFF", "FHFH", "FFFH", "HFFG"]
gym.make('FrozenLake-v1', desc=desc, is_slippery=True)
```

### æŸ¥çœ‹ç¯å¢ƒ

```python
# We create our environment with gym.make("<name_of_the_environment>")- `is_slippery=False`: The agent always moves in the intended direction due to the non-slippery nature of the frozen lake (deterministic).
print("_____OBSERVATION SPACE_____ \n")
print("Observation Space", env.observation_space)
print("Sample observation", env.observation_space.sample()) # Get a random observation
```

